<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>à·´ å¤§è‰åŸä¸å¯é¿ à·´</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Favicon è¨­å®š -->
    <link rel="icon" type="image/x-icon" href="icon/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon/android-chrome-512x512.png">
    <link rel="manifest" href="icon/site.webmanifest">
    <style>
        /* --- å…¨åŸŸè¨­å®šèˆ‡é¡è‰²è®Šæ•¸ --- */
        :root {
            --grass-green-dark: #2d6a4f;
            --grass-green-main: #40916c;
            --grass-green-light: #52b788;
            --grass-green-bg: #f0f4f0;
            --text-color: #1b4332;
            --border-color: #d8e9e0;
            --container-bg: #ffffff;
            --header-bg: #40916c;
            --header-text: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
        }

        body {
            height: 100vh;
            height: 100dvh;
            font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: var(--grass-green-bg);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* --- ä¸»è¦ App å®¹å™¨ --- */
        .app-container {
            width: 100%;
            height: 100%;
            max-width: 1280px;
            max-height: 720px;
            background-color: var(--container-bg);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* ç¢ºä¿å­å…ƒç´ çš„åœ“è§’æ­£ç¢ºé¡¯ç¤º */
        }

        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 12px 24px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        /* --- ä¸»è¦å…§å®¹å€ --- */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            padding-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-height: 0;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.6;
            background-color: #fdfdfd;
            color: var(--text-color);
            resize: none;
            flex-grow: 1;
            min-height: 200px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--grass-green-main);
            box-shadow: 0 0 0 3px rgba(64, 145, 108, 0.2);
        }

        /* --- æŒ‰éˆ• --- */
        .button-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            gap: 12px;
        }

        .button-group-left,
        .button-group-right {
            display: flex;
            gap: 8px;
        }

        .action-button {
            background-color: var(--grass-green-main);
            color: white;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
        }

        .action-button:hover {
            background-color: var(--grass-green-dark);
            transform: translateY(-1px);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button.outline {
            background-color: transparent;
            border: 1px solid var(--grass-green-main);
            color: var(--grass-green-main);
        }

        .action-button.outline:hover {
            background-color: var(--grass-green-main);
            color: white;
        }

        .copy-feedback {
            font-size: 0.9rem;
            color: var(--grass-green-main);
            text-align: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }

        /* --- æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ (å¯¬åº¦ <= 768px) --- */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .app-container {
                max-height: none;
                height: 100vh;
                height: 100dvh;
                /* ä½¿ç”¨ dynamic viewport height */
                border-radius: 0;
            }

            header {
                padding-top: 16px;
                /* çµ¦ç‹€æ…‹åˆ—ç•™é»ç©ºé–“ */
                font-size: 1.4rem;
            }

            .main-content {
                padding: 12px;
                gap: 12px;
                flex: 1;
            }

            .action-button {
                padding: 12px 14px;
                font-size: 0.85rem;
            }

            .button-group-left,
            .button-group-right {
                gap: 6px;
            }
        }
    </style>
</head>

<body>

    <div class="app-container">
        <header>
            à·´ å¤§è‰åŸä¸å¯é¿ à·´
        </header>

        <main class="main-content">
            <textarea id="main-text" placeholder="åœ¨é€™è£¡è¼¸å…¥æ–‡å­—..."></textarea>
            <div class="button-bar">
                <div class="button-group-left">
                    <button id="grass-btn" class="action-button" title="é•·è‰">
                        <span>à·´</span>
                        <span>é•·è‰</span>
                    </button>
                    <button id="copy-btn" class="action-button" title="è¤‡è£½">
                        <span>ğŸ“‹</span>
                        <span>è¤‡è£½</span>
                    </button>
                </div>
                <span id="copy-feedback" class="copy-feedback">å·²è¤‡è£½ï¼</span>
                <div class="button-group-right">
                    <button id="degrass-btn" class="action-button outline" title="é™¤è‰">
                        <span>ğŸª’</span>
                        <span>é™¤è‰</span>
                    </button>
                    <button id="clear-btn" class="action-button outline" title="æ¸…é™¤">
                        <span>ğŸ—‘ï¸</span>
                        <span>æ¸…é™¤</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script src="grass.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- å‹•æ…‹å»ºç«‹å°ç…§è¡¨ ---
            const TO_GRASSED_MAP = {};
            const TO_TRIMMED_MAP = {};

            if (typeof TRIMMED_CHARS !== 'undefined' && typeof GRASSED_CHARS !== 'undefined') {
                // ä½¿ç”¨ Array.from æˆ– [...string] ä¾†æ­£ç¢ºè™•ç† UTF-16 surrogate pairs
                const originalChars = [...TRIMMED_CHARS];
                const grassChars = [...GRASSED_CHARS];

                for (let i = 0; i < originalChars.length; i++) {
                    const originalChar = originalChars[i];
                    const grassChar = grassChars[i];

                    // åªæœ‰ç•¶è©²å­—ç¬¦é‚„æ²’æœ‰å°ç…§é—œä¿‚æ™‚æ‰å»ºç«‹ï¼Œé¿å…é‡è¤‡è¦†è“‹
                    if (!TO_GRASSED_MAP[originalChar]) {
                        TO_GRASSED_MAP[originalChar] = grassChar;
                    }
                    if (!TO_TRIMMED_MAP[grassChar]) {
                        TO_TRIMMED_MAP[grassChar] = originalChar;
                    }
                }
            } else {
                console.error('grass.js è¼‰å…¥å¤±æ•—æˆ–è³‡æ–™ä¸æ­£ç¢ºã€‚');
            }

            // --- DOM å…ƒç´  ---
            const mainText = document.getElementById('main-text');
            const grassBtn = document.getElementById('grass-btn');
            const degrassBtn = document.getElementById('degrass-btn');
            const clearBtn = document.getElementById('clear-btn');
            const copyBtn = document.getElementById('copy-btn');
            const copyFeedback = document.getElementById('copy-feedback');

            const headerTitle = document.querySelector('.app-container > header');
            const grassBtnLabel = grassBtn.querySelectorAll('span')[1];
            const degrassBtnLabel = degrassBtn.querySelectorAll('span')[1];
            const clearBtnLabel = clearBtn.querySelectorAll('span')[1];

            const ORIGINAL_TEXTS = {
                header: headerTitle.textContent,
                grass: grassBtnLabel.textContent,
                degrass: degrassBtnLabel.textContent,
                clear: clearBtnLabel.textContent,
            };

            const TRIMMED_TEXTS = {
                header: 'à·´ å¤§è‰åŸä¸å¯é¿ à·´',
                grass: 'é•·è‰',
                degrass: 'é™¤è‰',
                clear: 'æ¸…é™¤',
            };

            const GRASSED_TEXTS = {
                header: 'à·´ èŠ–è‰è’èŠ£è‹›é¿ à·´',
                grass: 'è‡è‰',
                degrass: 'è’¢è‰',
                clear: 'è”³è’¢',
            };

            function applyUiTexts(texts) {
                const t = texts || TRIMMED_TEXTS;
                headerTitle.textContent = t.header;
                grassBtnLabel.textContent = t.grass;
                degrassBtnLabel.textContent = t.degrass;
                clearBtnLabel.textContent = t.clear;
            }

            // --- æ ¸å¿ƒè½‰æ›åŠŸèƒ½ ---
            function toGrassed(text) {
                let result = '';
                for (const char of text) {
                    result += TO_GRASSED_MAP[char] || char;
                }
                return result;
            }

            function toTrimmed(text) {
                let result = '';
                for (const char of text) {
                    result += TO_TRIMMED_MAP[char] || char;
                }
                return result;
            }

            // --- äº‹ä»¶ç›£è½ ---
            function updateUrl(mode, text) {
                const params = new URLSearchParams();
                if (mode) {
                    params.set('mode', mode);
                }
                if (text) {
                    params.set('q', text);
                }
                const newUrl = window.location.pathname + (params.toString() ? `?${params.toString()}` : '');
                history.replaceState(null, '', newUrl);
            }

            grassBtn.addEventListener('click', () => {
                const currentText = mainText.value;
                if (currentText) {
                    mainText.value = toGrassed(currentText);
                }
                applyUiTexts(GRASSED_TEXTS);
                updateUrl('grassed', mainText.value);
            });

            degrassBtn.addEventListener('click', () => {
                const currentText = mainText.value;
                if (currentText) {
                    mainText.value = toTrimmed(currentText);
                }
                applyUiTexts(TRIMMED_TEXTS);
                updateUrl('trimmed', mainText.value);
            });

            clearBtn.addEventListener('click', () => {
                mainText.value = '';
                mainText.focus();
                applyUiTexts(ORIGINAL_TEXTS);
                updateUrl();
            });

            copyBtn.addEventListener('click', () => {
                if (mainText.value) {
                    navigator.clipboard.writeText(mainText.value).then(() => {
                        copyFeedback.style.visibility = 'visible';
                        copyFeedback.style.opacity = '1';
                        setTimeout(() => {
                            copyFeedback.style.opacity = '0';
                            copyFeedback.style.visibility = 'hidden';
                        }, 1500);
                    }).catch(err => {
                        console.error('è¤‡è£½å¤±æ•—:', err);
                    });
                }
            });

            // --- åˆå§‹è¼‰å…¥ ---
            const urlParams = new URLSearchParams(window.location.search);
            const urlText = urlParams.get('q');
            const urlMode = urlParams.get('mode');

            if (urlText) {
                mainText.value = urlText;
                if (urlMode === 'grassed') {
                    mainText.value = toGrassed(mainText.value);
                } else if (urlMode === 'trimmed') {
                    mainText.value = toTrimmed(mainText.value);
                }
            }

            if (urlMode === 'grassed') {
                applyUiTexts(GRASSED_TEXTS);
            } else if (urlMode === 'trimmed') {
                applyUiTexts(TRIMMED_TEXTS);
            } else {
                applyUiTexts(ORIGINAL_TEXTS);
            }

            mainText.focus();
        });

    </script>

</body>

</html>
